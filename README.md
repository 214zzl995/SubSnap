# SubSnap - å¤šæ¨¡å¼YUVåˆ°RGBè½¬æ¢æ€§èƒ½æµ‹è¯•å·¥å…·

ä¸€ä¸ªæ”¯æŒå¤šç§YUVåˆ°RGBè½¬æ¢å®ç°çš„æ€§èƒ½æµ‹è¯•å’Œå¯¹æ¯”å·¥å…·ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ”¯æŒçš„è½¬æ¢æ¨¡å¼

1. **FFmpegæ¨¡å¼** (`ffmpeg`) - ä½¿ç”¨FFmpeg SWScaleè¿›è¡ŒCPUè½¬æ¢
   - âœ… é»˜è®¤å¯ç”¨ï¼Œæ— éœ€é¢å¤–feature
   - ğŸ”§ æˆç†Ÿç¨³å®šï¼Œå…¼å®¹æ€§å¥½
   - ğŸ’» CPUä¼˜åŒ–ï¼Œæ”¯æŒå¤šç§åƒç´ æ ¼å¼

2. **OpenCVæ¨¡å¼** (`opencv`) - ä½¿ç”¨OpenCVåº“è¿›è¡ŒCPUè½¬æ¢
   - âœ… é»˜è®¤å¯ç”¨ï¼Œæ— éœ€é¢å¤–feature
   - ğŸ¨ ä½¿ç”¨OpenCVçš„cvt_colorå‡½æ•°è¿›è¡Œæ ‡å‡†åŒ–è½¬æ¢
   - ğŸ“š é€‚åˆä½¿ç”¨OpenCVåº“è¿›è¡Œè‰²å½©ç©ºé—´è½¬æ¢

3. **æ‰‹å·¥æ¨¡å¼** (`manual`) - ä½¿ç”¨æ‰‹å·¥å®ç°è¿›è¡ŒCPUè½¬æ¢
   - âœ… é»˜è®¤å¯ç”¨ï¼Œæ— éœ€é¢å¤–feature
   - ğŸ¨ æ‰‹å·¥å®ç°çš„YUVåˆ°RGBè½¬æ¢ç®—æ³•
   - ğŸ“š é€‚åˆå­¦ä¹ å’Œç†è§£è½¬æ¢åŸç†

4. **WGPUæ¨¡å¼** (`wgpu`) - ä½¿ç”¨WGPUè¿›è¡ŒGPUåŠ é€Ÿè½¬æ¢
   - ğŸ¯ éœ€è¦ `--features wgpu-mode` å¯ç”¨
   - ğŸš€ GPUè®¡ç®—ç€è‰²å™¨åŠ é€Ÿ
   - âš¡ é€‚åˆæ‰¹é‡å¤„ç†å¤§é‡å¸§

5. **yuvutils-rsæ¨¡å¼** (`yuvutils`) - ä½¿ç”¨yuvutils-rsè¿›è¡Œé«˜æ€§èƒ½CPUè½¬æ¢
   - ğŸ¯ éœ€è¦ `--features yuvutils-mode` å¯ç”¨
   - ğŸ”¥ çº¯Rustå®ç°ï¼ŒSIMDä¼˜åŒ–
   - ğŸ† ä¸“é—¨é’ˆå¯¹YUV420Pæ ¼å¼ä¼˜åŒ–

## ğŸ“¦ å®‰è£…å’Œç¼–è¯‘

### åŸºç¡€åŠŸèƒ½ï¼ˆFFmpeg + OpenCVæ¨¡å¼ï¼‰
```bash
cargo build --release
```

### å¯ç”¨WGPU GPUåŠ é€Ÿ
```bash
cargo build --release --features wgpu-mode
```

### å¯ç”¨yuvutils-rsé«˜æ€§èƒ½æ¨¡å¼
```bash
cargo build --release --features yuvutils-mode
```

### å¯ç”¨æ‰€æœ‰æ¨¡å¼
```bash
cargo build --release --features all-modes
```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹å¯ç”¨æ¨¡å¼
```bash
cargo run -- --list-modes
```

### 2. æµ‹è¯•å•ä¸ªæ¨¡å¼
```bash
# æµ‹è¯•FFmpegæ¨¡å¼
cargo run -- --mode ffmpeg --frames 10

# æµ‹è¯•OpenCVæ¨¡å¼
cargo run -- --mode opencv --frames 10

# æµ‹è¯•æ‰‹å·¥æ¨¡å¼
cargo run -- --mode manual --frames 10

# æµ‹è¯•WGPUæ¨¡å¼ï¼ˆéœ€è¦å¯¹åº”featureï¼‰
cargo run --features wgpu-mode -- --mode wgpu --frames 10

# æµ‹è¯•yuvutilsæ¨¡å¼ï¼ˆéœ€è¦å¯¹åº”featureï¼‰
cargo run --features yuvutils-mode -- --mode yuvutils --frames 10
```

### 3. è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
```bash
# å¯¹æ¯”æ‰€æœ‰å¯ç”¨çš„æ¨¡å¼
cargo run --features all-modes -- --benchmark --frames 50

# ä»…å¯¹æ¯”FFmpegå’ŒWGPU
cargo run --features wgpu-mode -- --benchmark --frames 50
```

### 4. ä¿å­˜è½¬æ¢åçš„å›¾ç‰‡
```bash
# æµ‹è¯•å¹¶ä¿å­˜å›¾ç‰‡
cargo run -- --mode ffmpeg --frames 5 --save-images

# æ€§èƒ½æµ‹è¯•åä¿å­˜æœ€ä½³æ¨¡å¼çš„ç»“æœ
cargo run --features all-modes -- --benchmark --frames 10 --save-images
```

### 5. ä½¿ç”¨è‡ªå®šä¹‰è¾“å…¥æ–‡ä»¶
```bash
cargo run -- --mode ffmpeg --input my_video.mp4 --frames 5 --output my_output
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹

```bash
$ cargo run --features all-modes -- --benchmark --frames 50

ğŸ† è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•...
ğŸ“¸ æå–äº† 50 å¸§ç”¨äºæ€§èƒ½æµ‹è¯• (1920x1080, YUV420P)

ğŸš€ å¼€å§‹æµ‹è¯• ä½¿ç”¨FFmpeg SWScaleè¿›è¡ŒCPUè½¬æ¢ æ¨¡å¼...
ğŸ“Š ä½¿ç”¨FFmpeg SWScaleè¿›è¡ŒCPUè½¬æ¢ è½¬æ¢æ€§èƒ½ç»Ÿè®¡:
  ğŸï¸  å¤„ç†å¸§æ•°: 50
  â±ï¸  æ€»è€—æ—¶: 0.05ç§’
  ğŸ“ˆ å¹³å‡æ¯å¸§: 1.00ms
  ğŸš€ è½¬æ¢FPS: 1000.0

ğŸš€ å¼€å§‹æµ‹è¯• ä½¿ç”¨OpenCVè¿›è¡ŒCPUè½¬æ¢ æ¨¡å¼...
ğŸ“Š ä½¿ç”¨OpenCVè¿›è¡ŒCPUè½¬æ¢ è½¬æ¢æ€§èƒ½ç»Ÿè®¡:
  ğŸï¸  å¤„ç†å¸§æ•°: 50
  â±ï¸  æ€»è€—æ—¶: 0.05ç§’
  ğŸ“ˆ å¹³å‡æ¯å¸§: 1.00ms
  ğŸš€ è½¬æ¢FPS: 1000.0

ğŸš€ å¼€å§‹æµ‹è¯• ä½¿ç”¨æ‰‹å·¥å®ç°è¿›è¡ŒCPUè½¬æ¢ æ¨¡å¼...
ğŸ“Š ä½¿ç”¨æ‰‹å·¥å®ç°è¿›è¡ŒCPUè½¬æ¢ è½¬æ¢æ€§èƒ½ç»Ÿè®¡:
  ğŸï¸  å¤„ç†å¸§æ•°: 50
  â±ï¸  æ€»è€—æ—¶: 0.16ç§’
  ğŸ“ˆ å¹³å‡æ¯å¸§: 3.12ms
  ğŸš€ è½¬æ¢FPS: 320.5

ğŸš€ å¼€å§‹æµ‹è¯• ä½¿ç”¨WGPUè¿›è¡ŒGPUåŠ é€Ÿè½¬æ¢ æ¨¡å¼...
ğŸ“Š ä½¿ç”¨WGPUè¿›è¡ŒGPUåŠ é€Ÿè½¬æ¢ è½¬æ¢æ€§èƒ½ç»Ÿè®¡:
  ğŸï¸  å¤„ç†å¸§æ•°: 50
  â±ï¸  æ€»è€—æ—¶: 0.25ç§’
  ğŸ“ˆ å¹³å‡æ¯å¸§: 4.90ms
  ğŸš€ è½¬æ¢FPS: 203.7

ğŸš€ å¼€å§‹æµ‹è¯• ä½¿ç”¨yuvutils-rsè¿›è¡Œé«˜æ€§èƒ½CPUè½¬æ¢ æ¨¡å¼...
ğŸ“Š ä½¿ç”¨yuvutils-rsè¿›è¡Œé«˜æ€§èƒ½CPUè½¬æ¢ è½¬æ¢æ€§èƒ½ç»Ÿè®¡:
  ğŸï¸  å¤„ç†å¸§æ•°: 50
  â±ï¸  æ€»è€—æ—¶: 0.05ç§’
  ğŸ“ˆ å¹³å‡æ¯å¸§: 1.00ms
  ğŸš€ è½¬æ¢FPS: 1000.0

ğŸ† æ€§èƒ½å¯¹æ¯”æ€»ç»“:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ¨¡å¼       â”‚ å¸§æ•°     â”‚ å¹³å‡è€—æ—¶ â”‚   FPS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ffmpeg          â”‚       50 â”‚   1.00ms â”‚ 1000.0   â”‚
â”‚ opencv          â”‚       50 â”‚   1.00ms â”‚ 1000.0   â”‚
â”‚ yuvutils        â”‚       50 â”‚   1.00ms â”‚ 1000.0   â”‚
â”‚ manual          â”‚       50 â”‚   3.12ms â”‚  320.5   â”‚
â”‚ wgpu            â”‚       50 â”‚   4.90ms â”‚  203.7   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ¥‡ æœ€å¿«æ¨¡å¼: ffmpeg/opencv/yuvutils (1000.0 FPS)
```

### æ€§èƒ½åˆ†æ

1. **FFmpegæ¨¡å¼** - ğŸ¥‡ é¡¶çº§æ€§èƒ½ (1000.0 FPS)
   - é«˜åº¦ä¼˜åŒ–çš„Cåº“å®ç°
   - ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿå’ŒSIMDæŒ‡ä»¤
   - é€‚åˆç”Ÿäº§ç¯å¢ƒçš„é«˜æ€§èƒ½éœ€æ±‚

2. **OpenCVæ¨¡å¼** - ğŸ¥‡ é¡¶çº§æ€§èƒ½ (1000.0 FPS)
   - ä½¿ç”¨OpenCVçš„åŸç”Ÿè½¬æ¢å‡½æ•°
   - è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„æ ‡å‡†åº“
   - é€‚åˆä¸OpenCVé¡¹ç›®é›†æˆ

3. **yuvutils-rsæ¨¡å¼** - ğŸ¥‡ é¡¶çº§æ€§èƒ½ (1000.0 FPS)
   - ä¸“ä¸ºYUVè½¬æ¢ä¼˜åŒ–çš„Ruståº“
   - SIMDä¼˜åŒ–ï¼Œçº¯Rustå®ç°
   - å¹³è¡¡äº†æ€§èƒ½å’Œå†…å­˜å®‰å…¨

4. **Manualæ¨¡å¼** - ğŸ¥ˆ è‰¯å¥½æ€§èƒ½ (320.5 FPS)
   - æ‰‹å·¥å®ç°çš„è½¬æ¢ç®—æ³•
   - ä¸»è¦ç”¨äºæ•™è‚²å’Œç†è§£åŸç†
   - ç®—æ³•é€»è¾‘æ¸…æ™°é€æ˜

5. **WGPUæ¨¡å¼** - ğŸ¥‰ GPUåŠ é€Ÿ (203.7 FPS)
   - GPUè®¡ç®—ï¼Œé€‚åˆæ‰¹é‡å¤„ç†
   - å¹¶è¡Œä¼˜åŠ¿åœ¨å¤§é‡æ•°æ®æ—¶ä½“ç°
   - ç°ä»£GPU APIæ”¯æŒ

## ğŸ”§ å‘½ä»¤è¡Œé€‰é¡¹

```
SubSnap - å¤šæ¨¡å¼YUVåˆ°RGBè½¬æ¢æ€§èƒ½æµ‹è¯•å·¥å…·

Usage: sub-snap [OPTIONS]

Options:
  -m, --mode <MODE>         è½¬æ¢æ¨¡å¼ [possible values: ffmpeg, opencv, manual, wgpu, yuvutils]
  -b, --benchmark           æ˜¯å¦è¿è¡Œæ‰€æœ‰æ¨¡å¼çš„æ€§èƒ½å¯¹æ¯”æµ‹è¯•
  -i, --input <INPUT>       è¾“å…¥è§†é¢‘æ–‡ä»¶è·¯å¾„ [default: input.mp4]
  -f, --frames <FRAMES>     è¦æå–çš„å¸§æ•°ï¼ˆç”¨äºæµ‹è¯•ï¼‰ [default: 10]
  -s, --save-images         æ˜¯å¦ä¿å­˜è½¬æ¢åçš„å›¾ç‰‡
  -o, --output <OUTPUT>     è¾“å‡ºç›®å½• [default: extracted_frames]
  -l, --list-modes          åˆ—å‡ºå¯ç”¨çš„è½¬æ¢æ¨¡å¼
  -h, --help                Print help
  -V, --version             Print version
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### åŸºç¡€è¦æ±‚
- Rust 1.70+
- FFmpeg å¼€å‘åº“
- OpenCV å¼€å‘åº“

### WGPUæ¨¡å¼é¢å¤–è¦æ±‚
- æ”¯æŒç°ä»£å›¾å½¢APIçš„GPU (Vulkan/Metal/DX12)
- é€‚å½“çš„å›¾å½¢é©±åŠ¨ç¨‹åº

### yuvutils-rsæ¨¡å¼é¢å¤–è¦æ±‚
- æ”¯æŒSIMDæŒ‡ä»¤é›†çš„CPU (å¤§éƒ¨åˆ†ç°ä»£CPUéƒ½æ”¯æŒ)

## ğŸ› ï¸ å¼€å‘å’Œè°ƒè¯•

### è‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´çš„æ€§èƒ½æµ‹è¯•è„šæœ¬
./test_performance.sh
```

### å¯ç”¨æ—¥å¿—
```bash
RUST_LOG=debug cargo run -- --mode ffmpeg --frames 3
```

### ä»…ç¼–è¯‘æ£€æŸ¥
```bash
cargo check --features all-modes
```

### è¿è¡Œæµ‹è¯•
```bash
cargo test --features all-modes
```

### æ€§èƒ½è°ƒä¼˜
```bash
# å¯ç”¨CPUç‰¹å®šä¼˜åŒ–
RUSTFLAGS="-C target-cpu=native" cargo build --release --features all-modes
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. æ€§èƒ½è¯„ä¼°
- æµ‹è¯•ä¸åŒè½¬æ¢æ¨¡å¼åœ¨ç‰¹å®šç¡¬ä»¶ä¸Šçš„æ€§èƒ½
- æ‰¾å‡ºæœ€é€‚åˆå½“å‰ç¯å¢ƒçš„è½¬æ¢æ–¹æ¡ˆ

### 2. ç®—æ³•éªŒè¯
- éªŒè¯ä¸åŒå®ç°çš„è½¬æ¢ç»“æœä¸€è‡´æ€§
- è°ƒè¯•è½¬æ¢è´¨é‡é—®é¢˜

### 3. æ‰¹å¤„ç†ä¼˜åŒ–
- ä¸ºå¤§è§„æ¨¡è§†é¢‘å¤„ç†é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ
- æ ¹æ®ç¡¬ä»¶é…ç½®é€‰æ‹©åˆé€‚çš„å¹¶è¡Œç­–ç•¥

### 4. å­¦ä¹ å’Œç ”ç©¶
- æ¯”è¾ƒä¸åŒå®ç°çš„è½¬æ¢ç®—æ³•
- ç†è§£YUVåˆ°RGBè½¬æ¢çš„åŸç†

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
src/
â”œâ”€â”€ main.rs                     # å‘½ä»¤è¡Œç•Œé¢å’Œä¸»ç¨‹åºé€»è¾‘
â”œâ”€â”€ converter.rs                # æ ¸å¿ƒè½¬æ¢å™¨æ¡†æ¶å’Œæ€§èƒ½æµ‹è¯•
â”œâ”€â”€ converters/                 # æ¨¡å—åŒ–è½¬æ¢å™¨å®ç°
â”‚   â”œâ”€â”€ mod.rs                  # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ ffmpeg_converter.rs     # FFmpeg SWScaleå®ç°
â”‚   â”œâ”€â”€ opencv_converter.rs     # çœŸæ­£çš„OpenCVå®ç°
â”‚   â”œâ”€â”€ manual_converter.rs     # æ‰‹å·¥å®ç°è½¬æ¢å™¨
â”‚   â”œâ”€â”€ wgpu_converter.rs       # WGPU GPUå®ç°
â”‚   â””â”€â”€ yuvutils_converter.rs   # yuvutils-rså®ç°
â”œâ”€â”€ wgpu_processor.rs           # WGPU GPUå¤„ç†å™¨
â”œâ”€â”€ yuv_to_rgb.wgsl            # WGPUè®¡ç®—ç€è‰²å™¨
â””â”€â”€ (å…¶ä»–æ¨¡å—...)               # é…ç½®ã€å¸§å¤„ç†ç­‰æ”¯æŒæ¨¡å—
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯¹äºç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨FFmpegæ¨¡å¼è·å¾—æˆç†Ÿç¨³å®šçš„æœ€ä½³æ€§èƒ½
2. **å¯¹äºè®¡ç®—æœºè§†è§‰é¡¹ç›®**: ä½¿ç”¨OpenCVæ¨¡å¼ä¸ç°æœ‰OpenCVä»£ç é›†æˆ
3. **å¯¹äºçº¯Rustç¯å¢ƒ**: ä½¿ç”¨yuvutils-rsæä¾›å†…å­˜å®‰å…¨çš„é«˜æ€§èƒ½é€‰æ‹©
4. **å¯¹äºå­¦ä¹ ç ”ç©¶**: ä½¿ç”¨Manualæ¨¡å¼ç†è§£è½¬æ¢åŸç†
5. **å¯¹äºGPUä¸°å¯Œç¯å¢ƒ**: WGPUæ¨¡å¼é€‚åˆå¤§è§„æ¨¡å¹¶è¡Œå¤„ç†

## ğŸ“– æ–‡æ¡£

- [ğŸ“– README.md](./README.md) - å¿«é€Ÿå¼€å§‹å’ŒåŸºæœ¬ä½¿ç”¨
- [ğŸ”§ TECHNICAL_DETAILS.md](./TECHNICAL_DETAILS.md) - æŠ€æœ¯å®ç°è¯¦æƒ…
- [ğŸ§ª test_performance.sh](./test_performance.sh) - è‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•è„šæœ¬

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ï¿½ï¿½ è®¸å¯è¯

MIT License
